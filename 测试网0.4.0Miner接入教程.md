

1个miner对应多个storagenode

# 配置miner节点

## 1. 下载安装包并解压

创建目录并进入 

```
mkdir -p ~/LambdaIM && cd ~/LambdaIM
```
下载安装包
```
wget https://github.com/LambdaIM/launch/releases/download/v0.4.0/lambda-0.4.0-testnet.tar.gz
```
解压安装包
```
tar zxvf lambda-0.4.0-testnet.tar.gz
```

## 2. 配置miner

```
./lambdacli config node tcp://47.93.196.236:26657

可选节点IP如下:
47.93.196.236
47.94.129.97
39.105.148.217

```

```
 ./lambdacli config chain-id lambda-chain-test4.0
```

```
./lambdacli config trust-node true
```
## 3. 添加账户
将[your-account-name]替换成您自定义的账户名称，需要设置您的账户密码，不用加中括号

```
./lambdacli keys add [your-account-name]
```
如果是钱包创建的账户导入，则通过钱包创建账户时候的助记词进行操作

```
./lambdacli keys add [your-account-name] --recover
```
输入命令后按照提示输入密码和助记词即可

## 4. 创建miner
质押到节点。
节点地址 可通过浏览器查找 http://testbrowser.lambda.im/#/ 或询问节点，
[your-account-name] 是您在第5步创建的账户名称
### 创建矿工
```
./lambdacli tx staking delegate lambdavaloper1prrcl9674j4aqrgrzmys5e28lkcxmntxuvjpcl 20000000utbb --from [your-account-name] --broadcast-mode block
可选节点地址：
lambdavaloper1prrcl9674j4aqrgrzmys5e28lkcxmntxuvjpcl
lambdavaloper1thj5fv8d0dsh3aealhpxm9mvgxjfh87suwuj2h
lambdavaloper1a83p8s9gs5hua09xn5ktmahepst3vzg9u2l20d
```

### 初始化矿工
```
./lambdacli tx market create-miner --from [your-account-name] --broadcast-mode block -y
```
### 启动矿工服务
```
nohup ./lambdacli miner-server --from [miner-name] --query-interval 5 --laddr tcp://0.0.0.0:26670 --gas 500000 >> miner.log 2>&1 &
```


## 5. 注册storagenode

创建存储节点

machine-name：大于3小于16个字符，支持英文大小写和数字。
配置storagenode后执行`./storagenode info`查看dht-id、peer-id和pub-key。

```
./storagenode info
```
```
./lambdacli tx market create-machine --dht-id [dht-id] --name [machine-name] --peer-id [peer-id] --pub-key [pub-key] --from [your-miner-name] --broadcast-mode block -y
```



**storagenode配置参考下面**

## 6. 矿工创建卖单

赔付比率为1的是普通卖单和大于等于3的为优质卖单，优质卖单可指定卖单价格。size!< 1GB，min-buy-duration !< 1month，max-buy-duration !>60month。

### 创建卖单

一台矿机只允许存在一笔有可用空间的卖单

```
./lambdacli tx market create-sellorder --price 5000000ulamb  --rate [rate] --size [size]GB --market-name LambdaMarket --machine-name machineone --min-size [min-size]GB --min-buy-duration [min-buy-duration]month --max-buy-duration [max-buy-duration]month --from [miner-name] --broadcast-mode block -y
```
### 查询卖单


```
lambdacli query market miner-sellorders [address] [page] [limit] 
```

### 取消卖单

根据SellOrderID取消卖单
```
./lambdacli tx market cancel-order [orderId] --from [miner-name] --broadcast-mode block -y
Response:
```


## 7. 创建买单
矿工不能挂买单，只能换其他账户来挂买单。

创建优质买单需要指定对应的的卖单SellOrderID。

account-name为当前账户的名称；
duration为购买时长；
size为需要购买的空间，不小于对应卖单指定的最小购买空间。

### 创建普通买单

```
 ./lambdacli tx market create-buyorder --from [account-name] --duration [buy-duration]month --market-name LambdaMarket --size [size]GB --broadcast-mode block -y
```

### 创建优质买单

```
./lambdacli tx market create-buyorder --sellorder-id [orderId] --from kg --duration buy-duration]month --market-name firstmarket --size [size]GB --broadcast-mode block -y
```


